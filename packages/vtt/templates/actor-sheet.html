<div class="shattered-wilds-sheet">
	<style>
		@import url("systems/shattered-wilds/styles/actor-sheet.css");
	</style>

	<form class="actor-sheet">
		<section class="sheet-body">
			<div class="controls" style="display:flex; gap:8px; margin-bottom:8px;">
				<button type="button" data-action="sw-import"><i class="fas fa-upload"></i> Import</button>
				<button type="button" data-action="sw-export"><i class="fas fa-download"></i> Export</button>
			</div>

			{{#if characterSheet}}
				<div class="character-info">
					<p><strong>{{characterSheet.name}}</strong> - {{characterSheet.race.primaryRace}}{{#if characterSheet.race.halfRace}} / {{characterSheet.race.halfRace}}{{/if}} {{characterSheet.characterClass.characterClass}} (Level {{characterSheet.level}})</p>
					
					<div class="resources-row">
						{{#each resourcesArray}}
							<div class="resource-control">
								<span class="resource-label" title="{{name}}">{{shortName}}</span>
								<div class="resource-buttons">
									<button type="button" class="resource-btn minus" data-action="resource-change" data-resource="{{key}}" data-delta="-1">
										<i class="fas fa-minus"></i>
									</button>
									<span class="resource-value">{{current}}/{{max}}</span>
									<button type="button" class="resource-btn plus" data-action="resource-change" data-resource="{{key}}" data-delta="1">
										<i class="fas fa-plus"></i>
									</button>
								</div>
							</div>
						{{/each}}
						<div class="resource-control refill-control">
							<button type="button" class="refill-btn" data-action="refill-resources" title="Refill all resources to maximum">
								<i class="fas fa-battery-full"></i>
							</button>
						</div>
					</div>
				</div>

				<!-- Tab Navigation -->
				<div class="tabs-container">
					<div class="tab-buttons">
						<button type="button" class="tab-button {{#if isStatsTabActive}}active{{/if}}" data-tab="stats">
							<i class="fas fa-sitemap"></i> Stats
						</button>
						<button type="button" class="tab-button {{#if isFeatsTabActive}}active{{/if}}" data-tab="feats">
							<i class="fas fa-star"></i> Feats
						</button>
						<button type="button" class="tab-button {{#if isDebugTabActive}}active{{/if}}" data-tab="debug">
							<i class="fas fa-bug"></i> Debug
						</button>
					</div>

					<!-- Tab Content -->
					<div class="tab-content">
						<!-- Stats Tab -->
						<div class="tab-panel {{#if isStatsTabActive}}active{{/if}}" data-tab-panel="stats">
							{{#if statTreeData}}
								<div class="stat-tree-grid">
									<!-- Level Section -->
									<div class="level-section">
																	<div class="level-display">
								<span class="level-label">Level:</span>
								<div class="stat-value stat-clickable" data-action="roll-stat" data-stat-type="Level" data-modifier="{{statTreeData.level.modifier.value.value}}" title="Click for advanced options • Shift+Click for quick roll">
									<span class="points-circle" title="{{statTreeData.level.tooltip}}">{{statTreeData.level.points}}</span>
									<span class="modifier-value" title="{{statTreeData.level.tooltip}}">
										{{statTreeData.level.modifier.value.description}}
										{{#if statTreeData.level.hasWarning}}
											<i class="stat-icon warning fas fa-exclamation-triangle" title="{{statTreeData.level.tooltip}}"></i>
										{{else}}
											{{#if statTreeData.level.hasTooltip}}
												<i class="stat-icon info fas fa-info-circle" title="{{statTreeData.level.tooltip}}"></i>
											{{/if}}
										{{/if}}
									</span>
									<i class="fas fa-dice-d12 dice-icon"></i>
								</div>
							</div>
									</div>

									<!-- Main Grid Layout -->
									<div class="stat-grid-container">
										<!-- Vertical Realm Labels -->
										<div class="realm-labels">
																					{{#each statTreeData.realms}}
											<div class="realm-label {{type.name}}">
												<div class="realm-name">{{type.name}}</div>
												<div class="stat-value stat-clickable" data-action="roll-stat" data-stat-type="{{type.name}}" data-modifier="{{modifier.value.value}}" title="Click for advanced options • Shift+Click for quick {{type.name}} roll">
													<span class="points-circle" title="{{tooltip}}">{{points}}</span>
													<span class="modifier-value" title="{{tooltip}}">
														{{modifier.value.description}}
														{{#if hasWarning}}
															<i class="stat-icon warning fas fa-exclamation-triangle" title="{{tooltip}}"></i>
														{{else}}
															{{#if hasTooltip}}
																<i class="stat-icon info fas fa-info-circle" title="{{tooltip}}"></i>
															{{/if}}
														{{/if}}
													</span>
													<i class="fas fa-dice-d12 dice-icon"></i>
												</div>
											</div>
										{{/each}}
										</div>

										<!-- 3x3 Attribute Grid -->
										<div class="attributes-grid">
											{{#each statTreeData.realms}}
												{{#each attributes}}
													<div class="attribute-panel">
														<!-- Attribute Header -->
														<div class="attribute-header">
															<span class="attribute-name">{{type.name}}</span>
															<div class="stat-value stat-clickable" data-action="roll-stat" data-stat-type="{{type.name}}" data-modifier="{{modifier.value.value}}" title="Click for advanced options • Shift+Click for quick {{type.name}} roll">
																<span class="points-circle" title="{{tooltip}}">{{points}}</span>
																<span class="modifier-value" title="{{tooltip}}">
																	{{modifier.value.description}}
																	{{#if hasWarning}}
																		<i class="stat-icon warning fas fa-exclamation-triangle" title="{{tooltip}}"></i>
																	{{else}}
																		{{#if hasTooltip}}
																			<i class="stat-icon info fas fa-info-circle" title="{{tooltip}}"></i>
																		{{/if}}
																	{{/if}}
																</span>
																<i class="fas fa-dice-d12 dice-icon"></i>
															</div>
														</div>

														<!-- Skills List -->
														<div class="skills-list">
															{{#each skills}}
																<div class="skill-row">
																														<span class="skill-name">{{type.name}}</span>
													<div class="stat-value stat-clickable" data-action="roll-stat" data-stat-type="{{type.name}}" data-modifier="{{modifier.value.value}}" title="Click for advanced options • Shift+Click for quick {{type.name}} roll">
														<span class="points-circle" title="{{tooltip}}">{{points}}</span>
														<span class="modifier-value" title="{{tooltip}}">
															{{modifier.value.description}}
															{{#if hasWarning}}
																<i class="stat-icon warning fas fa-exclamation-triangle" title="{{tooltip}}"></i>
															{{else}}
																{{#if hasTooltip}}
																	<i class="stat-icon info fas fa-info-circle" title="{{tooltip}}"></i>
																{{/if}}
															{{/if}}
														</span>
														<i class="fas fa-dice-d12 dice-icon"></i>
													</div>
																</div>
															{{/each}}
														</div>
													</div>
												{{/each}}
											{{/each}}
										</div>
									</div>
								</div>
							{{/if}}
						</div>

						<!-- Feats Tab -->
						<div class="tab-panel {{#if isFeatsTabActive}}active{{/if}}" data-tab-panel="feats">
							{{#if featsData}}
								{{#if featsData.isEmpty}}
									<div class="feats-empty">
										<p>No feats assigned yet.</p>
									</div>
								{{else}}
									{{#if featsData.warnings.length}}
										<div class="feats-warnings">
											<i class="fas fa-exclamation-triangle"></i>
											<span>{{featsData.warnings.length}} warnings</span>
										</div>
									{{/if}}

									{{#each featsData.featsOrSlotsByLevel}}
										<div class="feat-level">
											<h3 class="feat-level-title">Level {{level}}</h3>
											<div class="feats-grid">
												{{#each featsOrSlots}}
													<div class="feat-box {{#if warning}}warning{{/if}} {{#if isEmpty}}empty{{/if}}">
														<div class="feat-header">
															<span class="feat-name">{{#if info}}{{info.name}}{{else}}Empty {{slot.name}}{{/if}}</span>
															{{#if warning}}
																<i class="fas fa-exclamation-triangle feat-warning-icon" title="{{warning}}"></i>
															{{/if}}
														</div>
														{{#if info.feat.description}}
															<div class="feat-description">{{info.feat.description}}</div>
														{{/if}}
													</div>
												{{/each}}
											</div>
										</div>
									{{/each}}
								{{/if}}
							{{else}}
								<div class="feats-loading">
									<p>Loading feats...</p>
								</div>
							{{/if}}
						</div>

						<!-- Debug Tab -->
						<div class="tab-panel {{#if isDebugTabActive}}active{{/if}}" data-tab-panel="debug">
							<div class="debug-section">
								<ul>
									{{#each props as |value key|}}
										<li><code>{{key}}</code>: {{value}}</li>
									{{/each}}
								</ul>
							</div>
						</div>
					</div>
				</div>
			{{else}}
				<p>No character data imported yet. Use the Import button to load a character.</p>
			{{/if}}
		</section>
	</form>
</div>


