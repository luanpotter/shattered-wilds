{{!--
Equipment Tab Section

Expected context:
- isEquipmentTabActive: boolean
- equipmentData: The equipment data
--}}
<div class="tab-panel {{#if isEquipmentTabActive}}active{{/if}}" data-tab-panel="equipment">
	<div class="equipment-toolbar">
		<button type="button" class="equipment-add-btn" data-action="add-equipment-item">
			<i class="fas fa-plus"></i> Add Item
		</button>
	</div>
	{{#if equipmentData}}
	{{#if equipmentData.isEmpty}}
	<div class="equipment-empty">
		<p>No equipment found.</p>
	</div>
	{{else}}
	<div class="equipment-list">
		{{#each equipmentData.items}}
		<div class="equipment-item" data-item-id="{{@index}}">
			<div class="equipment-header" data-action="toggle-equipment" data-item-index="{{@index}}">
				<span class="equipment-name">{{{headerDisplay}}}</span>
				<span class="equipment-type">{{itemType}}</span>
				<i class="fas fa-chevron-down equipment-toggle-icon"></i>
			</div>
			<div class="equipment-details" style="display: none;">
				<div class="equipment-details-header">
					<button type="button"
						class="equipment-edit-btn"
						data-action="edit-equipment-item"
						data-item-index="{{@index}}">
						<i class="fas fa-pen"></i> Edit Item
					</button>
				</div>

				{{#if modes.length}}
				<div class="equipment-modes">
					<h4>Modes</h4>
					{{#each modes}}
					{{#if (eq modeType "weapon")}}
					<div class="equipment-mode equipment-mode--weapon">
						<div class="equipment-mode-info">
							<span class="equipment-mode-type">{{type}}</span>
							<span class="equipment-mode-bonus">{{bonus}}</span>
							<span class="equipment-mode-primary">{{primaryAttribute}}</span>
							{{#if range}}
							<span class="equipment-mode-range">Range: {{range}}</span>
							{{/if}}
						</div>
						<button type="button" class="equipment-mode-action-btn"
							data-action="roll-weapon-attack"
							data-weapon-mode-option-idx="{{idx}}"
							title="Click for modal • Shift+Click for quick {{attackStat}} check roll">
							<i class="fas fa-dice-d12"></i> {{attackStat}} Check
						</button>
					</div>
					{{/if}}
					{{#if (eq modeType "armor")}}
					<div class="equipment-mode equipment-mode--armor">
						<div class="equipment-mode-info">
							<span class="equipment-mode-type">{{type}}</span>
							<span class="equipment-mode-bonus">{{bonus}}</span>
							{{#if dexPenalty}}
							<span class="equipment-mode-detail">DEX Penalty: {{dexPenalty}}</span>
							{{/if}}
						</div>
					</div>
					{{/if}}
					{{#if (eq modeType "shield")}}
					<div class="equipment-mode equipment-mode--shield">
						<div class="equipment-mode-info">
							<span class="equipment-mode-type">{{type}}</span>
							<span class="equipment-mode-bonus">{{bonus}}</span>
						</div>
						<div class="equipment-mode-actions">
							<button type="button"
								class="equipment-mode-action-btn"
								data-action="roll-shield-block"
								data-item-index="{{@../index}}"
								title="Click for modal • Shift+Click for quick Body check roll">
								<i class="fas fa-shield-alt"></i> Block
							</button>
							<button type="button"
								class="equipment-mode-action-btn"
								data-action="roll-shield-bash"
								data-item-index="{{@../index}}"
								title="Click for modal • Shift+Click for quick Shield Bash attack roll">
								<i class="fas fa-fist-raised"></i> Bash
							</button>
						</div>
					</div>
					{{/if}}
					{{#if (eq modeType "arcane")}}
					<div class="equipment-mode equipment-mode--arcane">
						<div class="equipment-mode-info">
							<span class="equipment-mode-type">{{componentType}}</span>
							<span class="equipment-mode-bonus">{{bonus}}</span>
							{{#if costs}}
							<span class="equipment-mode-detail">{{costs}}</span>
							{{/if}}
							{{#if category}}
							<span class="equipment-mode-detail">{{category}}</span>
							{{/if}}
						</div>
					</div>
					{{/if}}
					{{#if (eq modeType "generic")}}
					<div class="equipment-mode equipment-mode--generic">
						<div class="equipment-mode-info">
							<span class="equipment-mode-type">{{description}}</span>
							{{#if costs}}
							<span class="equipment-mode-detail">{{costs}}</span>
							{{/if}}
						</div>
					</div>
					{{/if}}
					{{/each}}
				</div>
				{{/if}}

				{{#if traits.length}}
				<div class="equipment-traits">
					<strong>Traits:</strong> {{#each traits}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
				</div>
				{{/if}}
			</div>
		</div>
		{{/each}}
	</div>
	{{/if}}
	{{else}}
	<div class="equipment-loading">
		<p>Loading equipment...</p>
	</div>
	{{/if}}
</div>
